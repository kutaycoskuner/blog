---
import Welcome from "../components/Welcome.astro";
import Layout from "../layouts/Layout.astro";
import ContentTree from "../components/ContentTree.svelte";
import TestDispatch from "../components/TestDispatch.svelte";

interface ContentDetails {
    name: string;
    author: string;
    created: string; // <-- Added
    updated: string; // <-- Added
    translator: string; // <-- Added
    editor: string; // <-- Added
    abstract: string;
    keywords: string[];
    language: string; // <-- Added
    visibility: boolean; // <-- Added
    image: string; // <-- Added
    imagecredit: string; // <-- Added
}

// 2. Define the reactive state using 'let'
let selectedContent: ContentDetails = {
    name: "",
    author: "",
    created: "",
    updated: "",
    translator: "",
    editor: "",
    abstract: "",
    keywords: [] as string[],
    language: "",
    visibility: false,
    image: "",
    imagecredit: "",
};

function updateSelectedContent(event: CustomEvent<ContentDetails | null>) {
    // ðŸ“¢ THIS MUST BE THE ONLY console.log HERE
    console.log("ASTRO HANDLER RECEIVED EVENT! ðŸš€ Data:", event.detail?.name);
    const content = event.detail;
}

// function updateSelectedContent(event: CustomEvent<ContentDetails | null>) {
//     console.log("asdf");
//     return;
//     const content = event.detail;

//     if (content) {
//         selectedContent = content;
//     } else {
//         // Re-initialize the state when content is null
//         selectedContent = {
//             name: "",
//             author: "",
//             created: "",
//             updated: "",
//             translator: "",
//             editor: "",
//             abstract: "",
//             keywords: [],
//             language: "",
//             visibility: false,
//             image: "",
//             imagecredit: "",
//         };
//     }
//     console.log("test");
// }
function handleEvent() {
    console.log("test");
}
---

<Layout>
    <div class="main">
        <ContentTree client:load />
    </div>
</Layout>

    <!-- <script type="module" define:vars={{ selectedContent }}>
            // Make a mutable copy
    let currentContent = selectedContent;

    function updateContent(newValue) {
        currentContent = newValue;
        document.getElementsByClassName("content-title")?[0].innerHTML = currentContent;
    }

    document.addEventListener("browseArticle", (event) => {
        if (event.detail) {
            currentContent = event.detail;
            updateContent(event.detail.name);
            console.log("Updated content:", currentContent);
        }
    });

    console.log("Initial content:", currentContent);
</script> -->

    <style scoped>
        .center-text {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 90vh;
            text-align: center;
            color: var(--col);
        }

        .main {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 0px;
        }

        .main-navigation {
            grid-column: -1 / 1;
        }

        .content-navigator {
            margin: auto;
            grid-column: 4 / 8;
            display: grid;
            place-items: center;
        }

        .preview {
            width: auto;
            position: relative;
            padding: 0.2em;
            grid-column: 9 / 13;
            margin: auto;
            border-radius: 2px;
        }

        .preview img {
            object-fit: contain;
            width: 100%;
            max-width: 860px;
            max-height: 480px;
            max-width: 100%;
            z-index: -1;
            opacity: 0.6;
        }

        .preview .content-title {
            font-family: monospace;
            font-weight: bold;
            font-size: 2em;
        }

        .preview .content-abstract {
            font-style: italic;
            font-family: monospace;
            margin-top: 2em;
        }

        .preview .content-language,
        .preview .content-editor,
        .content-translator {
            font-style: italic;
            opacity: 0.6;
        }

        .preview .content-author {
            text-align: right;
            margin-top: 4em;
            font-family: monospace;
            bottom: 0;
            right: 0;
        }

        @media (max-width: 480px) {
            .content-navigator {
                margin: 0 auto;
                grid-column: 2 / 16;
                display: grid;
                place-items: center;
            }
        }

        @media (min-width: 481px) and (max-width: 1024px) {
            .content-navigator {
                margin: 0 auto;
                grid-column: 2 / 16;
                display: grid;
                place-items: center;
                height: 80vh;
            }
        }
    </style>
</Layout>
